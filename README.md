# MultiChainer

MultiChainer is a JUCE 7+ audio plugin (AU + VST3) for **MIDI-triggered multiband sidechain ducking** with an embedded **HTML/CSS/JS** interface.

Audio is split into three FIR linear-phase bands, ducked independently by MIDI-triggered envelopes, then recombined with phase-coherent summation.

## Features

- 3-band linear-phase FIR crossover (low/mid/high)
- Two crossover points (`f1`, `f2`) with enforcement of `f1 < f2`
- Per-band MIDI trigger filters:
  - channel (`omni` or `1..16`)
  - note min/max (`0..127`)
- Per-band ducking envelope:
  - depth (`0..60 dB` attenuation)
  - delay (`0..200 ms`)
  - attack/hold/release
  - curve shape
  - smoothing
- Sample-accurate MIDI trigger scheduling using MIDI sample offsets
- FFT spectrum analyzer sent to the web UI via JUCE WebBrowser bridge
- Full parameter/state persistence using `AudioProcessorValueTreeState`

## Project Layout

```text
/Assets
  index.html
  styles.css
  app.js
/Source
  PluginProcessor.h/.cpp
  PluginEditor.h/.cpp
  /dsp
    LinearPhaseCrossover.h/.cpp
    MultibandDucker.h/.cpp
    EnvelopeFollower.h/.cpp
    MidiTrigger.h/.cpp
    FFTAnalyzer.h/.cpp
  /ui
    WebUIBridge.h/.cpp
CMakeLists.txt
```

## Build (macOS)

### Prerequisites

- Xcode + command line tools
- CMake 3.24+
- JUCE available in `./JUCE` (already expected by this repo)

### Configure + Build

```bash
cd /Users/jonathannieman/multiChainer
cmake -S . -B build -G "Xcode"
cmake --build build --config Release
```

Artifacts are generated by JUCE in the build tree for AU/VST3.

## Notes on DSP Design

- FIR crossover uses runtime-designed windowed-sinc lowpass filters with Blackman-Harris windowing.
- Bands are formed as:
  - `Low = LP(f1)`
  - `Mid = LP(f2) - LP(f1)`
  - `High = DelayedInput - LP(f2)`
- Plugin latency is set to FIR group delay (`(taps - 1) / 2`) so hosts can compensate.
- FIR coefficient redesign runs in a background thread and is swapped into audio processing without allocations in `processBlock`.

## Web UI Bridge

- `WebBrowserComponent` loads bundled assets from `BinaryData` via JUCE resource provider.
- JS -> C++: `paramChange` event payloads (`{ id, value }` or batched updates).
- C++ -> JS:
  - `state` event with full parameter snapshot
  - `fft` event with latest dB bins

## Known Limitations

- FIR implementation is direct-form time-domain convolution (optimized with symmetric taps), not FFT-partitioned convolution yet.
- Crossover transitions during aggressive automation are functional but not crossfaded between old/new FIR states.
- FFT currently displays output spectrum only (not separate input/output traces).
- UI curve editor controls release/curve shape directly; advanced multi-point envelope editing is a next step.

## Future Improvements

1. Add partitioned FFT convolution backend for lower CPU at high tap counts.
2. Crossfade filter-state transitions when swapping FIR coefficients.
3. Add true multi-point curve editor and optional note-off gated modes.
4. Add dedicated input/output analyzer overlays and selectable FFT sizes.
5. Add optional AAX target once SDK is configured.
